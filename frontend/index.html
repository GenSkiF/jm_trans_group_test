<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>JM Trans Group</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icons/6.7.0/css/flag-icons.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/statistics_styles.css">
  <link rel="stylesheet" href="css/drivers_styles.css">
  <link rel="stylesheet" href="css/left_menu.css">
  <!-- ÐœÐ¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ -->
  <link rel="stylesheet" href="css/mobile.css">
  <link rel="icon" href="favicon.ico">
</head>
<body>  
  <!-- ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ --> 
  <div class="auth-container" id="auth-block">
    <div class="auth-card">
      <div class="auth-header">
        <img src="assets/jmtglogo.png" alt="JM Trans Group Logo" class="auth-logo">
        <div id="auth-title" class="mt-2 h5">Enter to JM Trans Group</div>
      </div>
      <form class="auth-form" id="auth-form">
        <div class="form-group">
          <label for="username"></label>
          <input type="text" id="username" placeholder="Login" required>
        </div>
        <div class="form-group">
          <label for="password"></label>
          <input type="password" id="password" placeholder="Password" required>
        </div>
        <div id="register-fields" style="display:none;">
          <div class="form-group">
            <label for="password2"></label>
            <input type="password" id="password2" placeholder="Repeat password">
            <label for="name"></label>
            <input type="text" id="name" placeholder="name">
            <label for="surname"></label>
            <input type="text" id="surname" placeholder="surname">
            <label for="phone"></label>
            <input type="text" id="phone" placeholder="phone">
            <label for="email"></label>
            <input type="email" id="email" placeholder="Email">
            <label for="code"></label>
            <input type="text" id="code" placeholder="Verification code">
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submit-btn">Enter</button>
          <button type="button" class="btn btn-secondary" id="show-register">Register</button>
        </div>
        <div class="form-footer">
          <button type="button" class="btn-link" id="forgot-password">Forgot password?</button>
          <button type="button" class="btn-link" id="get-code">Get code</button>
        </div>
        <div id="auth-error" style="display:none;"></div>
        <div id="auth-success" style="display:none;"></div>
      </form>
    </div>
  </div> 
   

  <!-- Ð“Ð»Ð°Ð²Ð½Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑÐ°Ð¹Ñ‚Ð° <Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ layout> -->
  <div id="main-section" style="display:none;">
    <div class="app-root">
      <!-- Ð’ÐµÑ€Ñ…Ð½ÑÑ ÑÐ¸Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
      <header class="mainbar-layout">
        <div class="mainbar">
          <button class="plus-btn" id="plus-btn" title="Add">ï¼‹</button>
          <div class="search-wrapper">
            <input type="text" class="search-input" id="search-input" placeholder="Search" oninput="onGlobalSearch()">
            <div id="autocomplete-list" class="autocomplete-list"></div>
          </div>
          <button class="mainbar-btn" onclick="showSection('maps')" id="btn-maps" title="ÐšÐ°Ñ€Ñ‚Ð°">ðŸ—º</button>
          <span class="mainbar-right">
            <span id="connection-status" class="connection-dot bg-danger"></span>
            <button class="round-btn" style="background:#ffae42;" title="Ð’Ñ‹Ð¹Ñ‚Ð¸" onclick="logout()">ðŸ”’</button>
          </span>
        </div>
      </header>

      <!-- Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð³Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€: Ð›Ð•Ð’ÐÐ¯ â€” Ð¦Ð•ÐÐ¢Ð  â€” ÐŸÐ ÐÐ’ÐÐ¯ -->
      <div class="main-horizontal">
        <!-- Ð›ÐµÐ²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ -->
        <aside id="MainMenu" class="left-menu">
          <!-- Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ°Ñ ÑˆÐ°Ð¿ÐºÐ° Ð½Ð°Ð´ ÐºÐ½Ð¾Ð¿ÐºÐ°Ð¼Ð¸ â€” ÑÑŽÐ´Ð° Ð¿Ð¾Ð·Ð¶Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿/Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ -->
          <div class="left-menu-header">
            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐ²ÐµÑ€Ð½ÑƒÑ‚ÑŒ/Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ -->
            <button class="collapse-toggle" id="leftmenu-toggle"
                    aria-label="Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¼ÐµÐ½ÑŽ"
                    aria-expanded="true"
                    title="Ð¡Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ/Ð Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ">
              <!-- Ð¨ÐµÐ²Ñ€Ð¾Ð½ (Ð¿Ð¾Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð² CSS Ð¿Ñ€Ð¸ ÑÐ²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ð¸) -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M14.5 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <!-- ÐšÐ»Ð¸ÐºÐ°Ð±ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð±Ñ€ÐµÐ½Ð´: Ð¿Ð¾Ð»Ð½Ð¾Ðµ Ð¸ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ Ð¸Ð¼Ñ -->
            <div class="brand-mini"
                id="brand-mini"
                data-full="JM TRANS GROUP"
                data-short="JMTG">JM TRANS GROUP</div>
          </div>

          <!-- Ð²ÐµÑ€Ñ…Ð½Ð¸Ð¹ Ð±Ð»Ð¾Ðº ÐºÐ½Ð¾Ð¿Ð¾Ðº -->
          <nav class="sidenav">
            <button class="left-menu-item" data-section="announcements" title="announcements"
                    onclick="showSection('announcements')" action="btn-announcements">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- ÐœÐµÐ³Ð°Ñ„Ð¾Ð½ -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M3 10v4a2 2 0 0 0 2 2h1l3 4h2l-1.5-4H17a4 4 0 0 0 4-4V8a4 4 0 0 1-4 4H8V8H5a2 2 0 0 0-2 2Z" fill="currentColor"/>
                  <path d="M20 4v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </span>
              <span class="left-menu-text">Announcements</span>
            </button>

            <button class="left-menu-item" data-section="transport" title="transport"
                    onclick="showSection('transport')" action="btn-transport">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- Ð“Ñ€ÑƒÐ·Ð¾Ð²Ð¸Ðº -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect x="2" y="7" width="11" height="6" rx="1.5" fill="currentColor"/>
                  <path d="M13 9h5l3 3v2h-8V9Z" fill="currentColor"/>
                  <circle cx="7" cy="17" r="2" fill="currentColor"/>
                  <circle cx="18" cy="17" r="2" fill="currentColor"/>
                </svg>
              </span>
              <span class="left-menu-text">Transport</span>
            </button>

            <button class="left-menu-item" data-section="logistics" title="logistics"
                    onclick="showSection('logistics')" action="btn-logistics">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- Ð¯Ñ‰Ð¸ÐºÐ¸ -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect x="3" y="5" width="8" height="6" rx="1.2" fill="currentColor"/>
                  <rect x="13" y="5" width="8" height="6" rx="1.2" fill="currentColor"/>
                  <rect x="8" y="13" width="8" height="6" rx="1.2" fill="currentColor"/>
                </svg>
              </span>
              <span class="left-menu-text">Logistics</span>
            </button>

            <button class="left-menu-item" data-section="accounting" title="accounting"
                    onclick="showSection('accounting')" action="btn-accounting">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€ -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect x="5" y="3" width="14" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                  <rect x="7" y="6" width="10" height="3" fill="currentColor"/>
                  <circle cx="9" cy="13" r="1.5" fill="currentColor"/>
                  <circle cx="13" cy="13" r="1.5" fill="currentColor"/>
                  <circle cx="17" cy="13" r="1.5" fill="currentColor"/>
                  <circle cx="9" cy="17" r="1.5" fill="currentColor"/>
                  <circle cx="13" cy="17" r="1.5" fill="currentColor"/>
                  <circle cx="17" cy="17" r="1.5" fill="currentColor"/>
                </svg>
              </span>
              <span class="left-menu-text">Accounting</span>
            </button>

            <div class="left-menu-sep"></div>
          </nav>

          <!-- Ð½Ð¸Ð¶Ð½Ð¸Ð¹ Ð±Ð»Ð¾Ðº ÐºÐ½Ð¾Ð¿Ð¾Ðº (Ð¿Ñ€Ð¸Ð±Ð¸Ñ‚ Ðº Ð½Ð¸Ð·Ñƒ) -->
          <nav class="sidenav">
            <button class="left-menu-item" data-section="statuses" title="statuses"
                    onclick="showSection('statuses')" action="btn-statuses">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- Ð§ÐµÐº-Ð»Ð¸ÑÑ‚ -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <rect x="4" y="3" width="16" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M8 8h8M8 12h8M8 16h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </span>
              <span class="left-menu-text">Statuses</span>
            </button>

            <button class="left-menu-item" data-section="statistics" title="statistics"
                    onclick="showSection('statistics')" action="btn-Statistics">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- Ð”Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð° -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M4 19V5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <rect x="6" y="11" width="3" height="8" fill="currentColor"/>
                  <rect x="11" y="7" width="3" height="12" fill="currentColor"/>
                  <rect x="16" y="9" width="3" height="10" fill="currentColor"/>
                </svg>
              </span>
              <span class="left-menu-text">Statistics</span>
            </button>
          </nav>
          <!-- ÑÑ‡ÐµÐ¹ÐºÐ°: Settings (Ð¿Ñ€Ð¸Ð±Ð¸Ñ‚Ð° Ðº Ð½Ð¸Ð·Ñƒ) -->
          <nav class="sidenav left-menu-bottom">
            <button class="left-menu-item" data-section="settings" title="settings"
                    onclick="alert('ÐŸÐ¾ÐºÐ° Ð½Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾')" action="btn-settings">
              <span class="left-menu-icon" aria-hidden="true">
                <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° Â«ÑˆÐµÑÑ‚ÐµÑ€Ñ‘Ð½ÐºÐ°Â» -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M19.4 12a7.4 7.4 0 0 0-.1-1l2.1-1.6-2-3.5-2.6 1a7.4 7.4 0 0 0-1.7-1l-.4-2.8h-4l-.4 2.8a7.4 7.4 0 0 0-1.7 1l-2.6-1-2 3.5L4.7 11a7.4 7.4 0 0 0 0 2l-2.1 1.6 2 3.5 2.6-1a7.4 7.4 0 0 0 1.7 1l.4 2.8h4l.4-2.8a7.4 7.4 0 0 0 1.7-1l2.6 1 2-3.5-2.1-1.6c.1-.3.1-.7.1-1Z"
                        stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
              </span>
              <span class="left-menu-text">Settings</span>
            </button>
          </nav>
        </aside>  
        <!-- Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
        <main class="layout-center">
          <div class="logo-center" id="main-logo-block">
            <img src="assets/jmtglogo.png" class="logo" id="main-logo" alt="Ð›Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿">
          </div>
          <div class="page-container">
            <div id="page-maps" style="display:none;"></div>
            <div id="page-announcements" style="display:none;">
              <div id="announcements-filters"></div>
              <div id="ann-list"></div>
            </div>
            <div id="page-transport" style="display:none;"></div>
            <div id="page-logistics" style="display:none;"></div>
            <div id="page-accounting" style="display:none;"></div>
            <div id="page-statuses" style="display:none;">
              <div id="statuses-filters"></div>
              <div id="statuses-content"></div>
            </div>
            <div id="page-statistics" style="display:none;">
              <div id="statistics-filters"></div>
              <div id="statistics-content"></div>
            </div>
          </div>
        </main>
      </div>

      <!-- ÐÐ¸Ð¶Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
      <footer class="layout-footer"></footer>
    </div>
  </div>


  <script type="module" src="./js/app.js"></script>
  <!-- ÐœÐ¾Ð´ÑƒÐ»Ð¸ -->
  <script type="module">
    import { initAnnouncements, showAnnouncementsSection } from './js/pages/announcements/index.js';
    import { showSection } from './js/core/router.js';
    import { AuthService } from './js/auth.js';
    import { WebSocketService } from './js/services/api.js';
    
    // ---- ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ/Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ----
    const form = document.getElementById('auth-form');
    const registerFields = document.getElementById('register-fields');
    const authTitle = document.getElementById('auth-title');
    const submitBtn = document.getElementById('submit-btn');
    const showRegisterBtn = document.getElementById('show-register');
    const getCodeBtn = document.getElementById('get-code');
    const forgotBtn = document.getElementById('forgot-password');
    const errorEl = document.getElementById('auth-error');
    const successEl = document.getElementById('auth-success');

    let isRegisterMode = false;
    let generatedCode = null;

    showRegisterBtn.onclick = function() {
      isRegisterMode = !isRegisterMode;
      registerFields.style.display = isRegisterMode ? 'block' : 'none';
      authTitle.textContent = isRegisterMode ? 'Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ' : 'Ð’Ñ…Ð¾Ð´ Ð² JM Trans Group';
      submitBtn.textContent = isRegisterMode ? 'Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ' : 'Ð’Ð¾Ð¹Ñ‚Ð¸';
      showRegisterBtn.textContent = isRegisterMode ? 'ÐÐ°Ð·Ð°Ð´ ÐºÐ¾ Ð²Ñ…Ð¾Ð´Ñƒ' : 'Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ';
      errorEl.style.display = 'none';
      successEl.style.display = 'none';
    };

    getCodeBtn.onclick = function() {
      generatedCode = Math.floor(1000 + Math.random() * 9000);
      showSuccess('Ð’Ð°Ñˆ ÐºÐ¾Ð´ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ: ' + generatedCode);
    };

    form.onsubmit = async function(e) {
      e.preventDefault();
      errorEl.style.display = 'none';
      successEl.style.display = 'none';

      if (isRegisterMode) {
        // --- Ð’ÐÐ›Ð˜Ð”ÐÐ¦Ð˜Ð¯ ---
        const userData = {
          username: document.getElementById('username').value.trim(),
          password: document.getElementById('password').value,
          password2: document.getElementById('password2').value,
          name: document.getElementById('name').value.trim(),
          surname: document.getElementById('surname').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          email: document.getElementById('email').value.trim(),
          code: document.getElementById('code').value.trim()
        };
        if (!userData.username || !userData.password || !userData.password2 || !userData.code) {
          showError('Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð»Ð¾Ð³Ð¸Ð½, Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¸ ÐºÐ¾Ð´ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ');
          return;
        }
        if (userData.password !== userData.password2) {
          showError('ÐŸÐ°Ñ€Ð¾Ð»Ð¸ Ð½Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´Ð°ÑŽÑ‚');
          return;
        }
        if (!generatedCode || userData.code != generatedCode) {
          showError('ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ñ');
          return;
        }

        try {
          await AuthService.register(userData);
          showSuccess('Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð°! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ.');
          showRegisterBtn.click();
        } catch (err) {
          showError(err.message || 'ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸');
        }
      } else {
        // Ð’Ð¥ÐžÐ”
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        if (!username || !password) {
          showError('Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð»Ð¾Ð³Ð¸Ð½ Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ');
          return;
        }
        try {
          await AuthService.login(username, password);
          WebSocketService.connect(); // ÐžÐ¢ÐšÐ Ð«Ð’ÐÐ•Ðœ WS Ð´Ð»Ñ PUSH
          // Ð¡ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ñƒ Ð»Ð¾Ð³Ð¸Ð½Ð°, Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ main
          document.getElementById('auth-block').style.display = 'none';
          document.getElementById('main-section').style.display = '';

          // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð·Ð°ÑÐ²ÐºÐ¸ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð°
          const syncData = await import('./js/services/api.js').then(({ WebSocketService }) =>
            WebSocketService.sendAndWait({ action: "sync_all" })
          );
          if (syncData && syncData.data) {
            initAnnouncements(syncData.data);
          }

          showSuccess('Ð’Ñ…Ð¾Ð´ ÑƒÑÐ¿ÐµÑˆÐµÐ½!');
          
        } catch (err) {
          showError(err.message || 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°');
        }
      }
    };

    forgotBtn.onclick = function() {
      alert('Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ð°Ñ€Ð¾Ð»Ñ Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ!');
    };

    function showError(msg) {
      errorEl.textContent = msg;
      errorEl.style.display = 'block';
      successEl.style.display = 'none';
    }
    function showSuccess(msg) {
      successEl.textContent = msg;
      successEl.style.display = 'block';
      errorEl.style.display = 'none';
    }

    // ÐŸÐ¾Ð´ÑÐ²ÐµÑ‚ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ mainbar
    function highlightMainbar(section) {
      document.querySelectorAll('.mainbar-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      if (section) {
        const btn = document.getElementById('btn-' + section);
        if (btn) btn.classList.add('active');
      }
    }
    window.highlightMainbar = highlightMainbar;

    // --- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑÑÐ¸Ð¸ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ ---
    window.addEventListener('DOMContentLoaded', async () => {
      try {
        const token = localStorage.getItem("jm_session_token");
        if (token) {
          await AuthService.resumeSession(token);
          WebSocketService.connect();
          document.getElementById('auth-block').style.display = 'none';
          document.getElementById('main-section').style.display = '';
          // <<< Ð’ÐžÐ¢ Ð”ÐžÐ‘ÐÐ’Ð›Ð¯Ð•Ðœ:
          const syncData = await WebSocketService.sendAndWait({ action: "sync_all" });
          if (syncData && syncData.data) {
            initAnnouncements(syncData.data);
          }
        }
      } catch {
        document.getElementById('auth-block').style.display = '';
        document.getElementById('main-section').style.display = 'none';
      }
    });

    async function onSearchMaps() {
      const q = (document.getElementById('search-input')?.value || '').trim();
      if (q.length < 2) return;
      // --- Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐµÑˆ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð¿Ð¾ ÑÑ‚Ñ€Ð¾ÐºÐµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° ---
      const KEY = 'geo_cache_v1';
      const cache = JSON.parse(localStorage.getItem(KEY) || '{}');
      if (cache[q] && cache[q].lat && cache[q].lon) {
        postToMap(cache[q], q);
        return;
      }

      // --- Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº Ñ‚Ð²Ð¾ÐµÐ¼Ñƒ /autocomplete_geo ---
      const url = `${location.protocol}//${location.hostname}:9101/autocomplete_geo?q=${encodeURIComponent(q)}&limit=1`;
      try {
        const r = await fetch(url, { cache: 'no-cache' });
        if (!r.ok) return;
        const arr = await r.json();
        if (!arr || !arr.length) return;

        const best = arr[0];
        const payload = {
          label: best.label || best.display_name || q,
          lat: Number(best.lat),
          lon: Number(best.lon),
          country_code: (best.country_code || '').toUpperCase(),
          type: best.type || 'place'
        };
        if (!Number.isFinite(payload.lat) || !Number.isFinite(payload.lon)) return;

        // ÐºÐµÑˆÐ¸Ñ€ÑƒÐµÐ¼
        cache[q] = payload;
        // Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð¼ ÐºÐµÑˆ Ð´Ð¾ 200 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
        const keys = Object.keys(cache);
        if (keys.length > 200) delete cache[keys[0]];
        localStorage.setItem(KEY, JSON.stringify(cache));

        postToMap(payload, q);
      } catch (e) {
        // Ñ‚Ð¸Ñ…Ð¾
      }

      function postToMap(p, qstr) {
        const frame =
          document.getElementById('map-iframe') ||
          document.querySelector('#page-maps iframe, .map-frame-wrap iframe');

        if (frame && frame.contentWindow) {
          frame.contentWindow.postMessage({
            type: 'map:add_marker',
            payload: p
          }, '*');
        }
      }
    }


    window.onGlobalSearch = function() {
      try {
        if (currentSection === 'announcements') {
          if (typeof window.onSearchAnnouncements === 'function') {
            window.onSearchAnnouncements();
          }
        } else if (currentSection === 'transport') {
          if (typeof window.onSearchTransport === 'function') {
            window.onSearchTransport();
          }
        } else if (currentSection === 'logistics') {
          if (typeof window.onSearchLogistics === 'function') {
            window.onSearchLogistics();
          }
        } else if (currentSection === 'maps') {
          if (typeof window.onSearchMaps === 'function') {
            window.onSearchMaps();
          }
        }
      } catch (e) {
        // Ð¼Ð¾Ð»Ñ‡Ð° Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð»Ð¾Ð¼Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹
      }
    };


    function showRegError(msg) {
      let err = document.getElementById('register-error');
      err.textContent = msg;
      err.style.display = 'block';
    }
    window.showRegError = showRegError;

    window.searchAllSections = function() {
      renderRequests();
    };

    window.logout = function() {
      AuthService.logout();
    } 
    
    // Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»: Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð·Ð°ÑÐ²ÐºÑƒ Ð¿Ð¾ id (ÐºÐ°Ñ€Ñ‚Ð° Ð²ÐµÑ€Ð½Ñ‘Ñ‚ Ð½Ð°Ð·Ð°Ð´)
    if (!window.openAnnouncementById) {
      window.openAnnouncementById = function(id) {
        if (typeof showSection === 'function') showSection('announcements');
        // Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð½Ð°Ð¹Ñ‚Ð¸ ÐºÐ»Ð¸ÐºÐ°Ð±ÐµÐ»ÑŒÐ½ÑƒÑŽ Ñ‡Ð°ÑÑ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð·Ð°ÑÐ²ÐºÐ¸
        const root = document;
        const candidates = [
          `[data-rid="${id}"] [data-action="open"]`,
          `[data-id="${id}"] [data-action="open"]`,
          `[data-request-id="${id}"] [data-action="open"]`,
          `[data-rid="${id}"]`,
          `[data-id="${id}"]`,
          `[data-request-id="${id}"]`,
        ];
        for (const sel of candidates) {
          const el = root.querySelector(sel);
          if (el) { el.dispatchEvent(new MouseEvent('click', {bubbles:true})); return true; }
        }
        return false;
      };
    }

    // ÐŸÐµÑ€ÐµÑ…Ð²Ð°Ñ‚ ÐºÐ»Ð¸ÐºÐ° Ð¿Ð¾ Â«ÐºÐ¾Ð¼Ð¿Ð°ÑÑƒÂ» (Ð±ÐµÐ· Ð·Ð½Ð°Ð½Ð¸Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑÐ°/Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð°)
    document.addEventListener('click', async (e) => {
      const btn = e.target.closest(`
        [data-open-route],
        [data-route],
        [data-map],
        [data-action*="route" i],
        [data-action*="map" i],
        .btn-route,
        .btn-map
      `);
      if (!btn) return;

      // Ð³Ð»ÑƒÑˆÐ¸Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð»Ð°ÑÑŒ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð²Ð¼ÐµÑÑ‚Ð¾ ÐºÐ°Ñ€Ñ‚Ñ‹
      e.preventDefault();
      e.stopPropagation();

      // Ð’Ñ‹Ð½Ð¸Ð¼Ð°ÐµÐ¼ id Ð·Ð°ÑÐ²ÐºÐ¸ Ð¸Ð· Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ñ… data-Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð²
      const host = btn.closest('[data-rid],[data-id],[data-request-id]') || btn;
      const id = Number(
        host?.dataset?.rid ??
        host?.dataset?.id ??
        host?.dataset?.requestId
      );
      if (!Number.isFinite(id)) return;

      // Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ñ€Ð°Ð·Ð´ÐµÐ» ÐºÐ°Ñ€Ñ‚Ñ‹ Ð¸ ÑÑ‚Ñ€Ð¾Ð¸Ð¼ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚
      if (typeof showSection === 'function') showSection('maps');
      await Promise.resolve(); // Ð¾Ð´Ð¸Ð½ Ñ‚Ð¸Ðº, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐµÐºÑ†Ð¸Ñ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²Ð°Ð»Ð°ÑÑŒ

      // Ð˜Ñ‰ÐµÐ¼ ÑƒÐ½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð° (ÐºÐ°Ñ€Ñ‚Ð° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð½Ñ‘Ñ‚ ÐµÑ‘)
      if (typeof window.openRouteOnMapForRequest === 'function') {
        window.openRouteOnMapForRequest(id); // Ð¼Ð¾Ð¶Ð½Ð¾ ID â€” ÐºÐ°Ñ€Ñ‚Ð° ÑÐ°Ð¼Ð° Ð½Ð°Ð¹Ð´Ñ‘Ñ‚ Ð¾Ð±ÑŠÐµÐºÑ‚
      } else {
        // fallback: ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
        console.warn('ÐœÐ°Ñ€ÑˆÑ€ÑƒÑ‚: Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ ÐºÐ°Ñ€Ñ‚Ñ‹ Ð½Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° (openRouteOnMapForRequest)');
      }
    }, true); // capture=true, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð¿ÐµÑ€ÐµÐ´Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ‰Ð¸Ð¹ click Ð¿Ð¾ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ

    // â€”â€”â€” Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº/Ñ„Ð¸Ð»ÑŒÑ‚Ñ€: Ð½Ðµ Ð¿Ð°Ð´Ð°ÐµÐ¼, ÐµÑÐ»Ð¸ ÑƒÐ·ÐºÐ¾ÑÐ¿ÐµÑ†. Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹
    if (!window.onGlobalSearch) {
      window.onGlobalSearch = function () {
        try {
          const sec = window.currentSection;
          if (sec === 'announcements' && typeof window.onSearchAnnouncements === 'function') {
            window.onSearchAnnouncements();
          } else if (sec === 'maps' && typeof window.onSearchMaps === 'function') {
            window.onSearchMaps();
          }
        } catch (_) {}
      };
    }

    // â€”â€”â€” Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Â«Ð—Ð°ÑÐ²ÐºÐ¸Â» Ð¿Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ñƒ Ñ‡ÐµÑ€ÐµÐ· Ð²Ð°ÑˆÐµ Ð¿Ð¾Ð»Ðµ #search-input
    if (!window.filterAnnouncementsByCity) {
      window.filterAnnouncementsByCity = function (city) {
        const input = document.getElementById('search-input');
        if (input) input.value = city || '';
        if (typeof window.onGlobalSearch === 'function') {
          window.onGlobalSearch();
        } else {
          // Ð·Ð°Ð¿Ð°ÑÐ½Ð¾Ð¹ Ð¿Ð»Ð°Ð½: Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ðµ ÑÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº Ð¿Ð¾ Ñ‚ÐµÐºÑÑ‚Ñƒ (ÐµÑÐ»Ð¸ ÑÐ¿ÐµÑ†. Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½)
          const list = document.getElementById('ann-list');
          if (list) {
            const q = String(city || '').toLowerCase();
            Array.from(list.children).forEach(el => {
              const txt = (el.innerText || '').toLowerCase();
              el.style.display = q ? (txt.includes(q) ? '' : 'none') : '';
            });
          }
        }
      };
    }

    // â€”â€”â€” Ð¥ÐµÐ»Ð¿ÐµÑ€: Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð·Ð°ÑÐ²ÐºÐ¸ Ð¿Ð¾ ID (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð¸Ð· ÐºÐ°Ñ€Ñ‚Ñ‹)
    if (!window.openAnnouncementById) {
      window.openAnnouncementById = function (id) {
        // Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð²Ð°ÑˆÑƒ Ñ‚ÐµÐºÑƒÑ‰ÑƒÑŽ Ð»Ð¾Ð³Ð¸ÐºÑƒ: ÐºÐ»Ð¸ÐºÐ°ÐµÐ¼ Ð¿Ð¾ Ñ‚Ð¾Ð¼Ñƒ, Ñ‡Ñ‚Ð¾ ÑƒÐ¶Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ
        const candidates = [
          `[data-rid="${id}"] [data-action="open"]`,
          `[data-id="${id}"] [data-action="open"]`,
          `[data-request-id="${id}"] [data-action="open"]`,
          `[data-rid="${id}"]`,
          `[data-id="${id}"]`,
          `[data-request-id="${id}"]`,
        ];
        for (const sel of candidates) {
          const el = document.querySelector(sel);
          if (el) { el.dispatchEvent(new MouseEvent('click', {bubbles:true})); return true; }
        }
        return false;
      };
    }

    // â€”â€”â€” ÐŸÐµÑ€ÐµÑ…Ð²Ð°Ñ‚ Â«ÐºÐ¾Ð¼Ð¿Ð°ÑÐ°Â» (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð´Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÐºÐ»Ð°ÑÑÑ‹/Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ñ‹ Ñƒ Ð²Ð°Ñ ÑÐ²Ð¾Ð¸)
    document.addEventListener('click', async (e) => {
      const btn = e.target.closest(`
        [data-open-route],
        [data-open-map],
        [data-action*="route" i],
        [data-action*="map" i],
        .btn-route,
        .route-btn,
        .fa-compass,
        .bi-compass,
        .icon-compass
      `);
      if (!btn) return;

      // Ð½Ðµ Ð´Ð°Ñ‘Ð¼ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‚Ð¸Ñ‚ÑŒ ÐºÐ»Ð¸Ðº
      e.preventDefault(); e.stopPropagation();

      // Ð±ÐµÑ€Ñ‘Ð¼ id Ð¸Ð· Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ñ… data-Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð² ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸
      const host = btn.closest('[data-request-id],[data-rid],[data-id]') || btn;
      const id = Number(host?.dataset?.requestId || host?.dataset?.rid || host?.dataset?.id);
      if (!Number.isFinite(id)) return;

      // Ð½Ð° ÐºÐ°Ñ€Ñ‚Ñƒ
      if (typeof window.showSection === 'function') window.showSection('maps');
      await Promise.resolve(); // Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒÑÑ Ð¾Ñ‚Ñ€Ð¸ÑÐ¾Ð²ÐºÐ¸

      if (typeof window.openRouteOnMapForRequest === 'function') {
        window.openRouteOnMapForRequest(id);
      } else {
        // ÐºÐ°Ñ€Ñ‚Ð° ÐµÑ‰Ñ‘ Ð½Ðµ ÑƒÑÐ¿ÐµÐ»Ð° ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð½ÑƒÑ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ â€” ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ð¼ Ð´Ð¾ ÐµÑ‘ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸
        window.__pendingRouteId = id;
      }
    }, true); // capture=true â€” Ð¾Ð¿ÐµÑ€ÐµÐ¶Ð°ÐµÐ¼ Ð¾Ð±Ñ‰Ð¸Ð¹ ÐºÐ»Ð¸Ðº Ð¿Ð¾ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ

    // â€”â€”â€” ÐšÐ°Ñ€Ñ‚Ñƒ Ð¿Ð¾Ð¿Ñ€Ð¾ÑÐ¸Ð¼ Ð·Ð°Ð±Ñ€Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚, ÐºÐ¾Ð³Ð´Ð° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ÑÑ
    window.__consumePendingRouteIfAny = function () {
      if (window.__pendingRouteId && typeof window.openRouteOnMapForRequest === 'function') {
        const id = window.__pendingRouteId; window.__pendingRouteId = null;
        window.openRouteOnMapForRequest(id);
      }
    };

    // === LEFT MENU COLLAPSE ===
    (function initLeftMenuCollapse(){
      const menu  = document.getElementById('MainMenu');
      const btn   = document.getElementById('leftmenu-toggle');
      const brand = document.getElementById('brand-mini');
      if (!menu || !btn || !brand) return;

      const LS_KEY = 'ui:leftmenu:collapsed:v1';

      function showHomeLogo() {
        // Ð£Ð½Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð²Ð°Ñˆ Ñ€Ð¾ÑƒÑ‚ÐµÑ€
        if (typeof window.showSection === 'function') {
          window.showSection('home'); // ÑƒÐ¹Ð´Ñ‘Ñ‚ Ð² default ÐºÐµÐ¹Ñ Ð¸ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿
        }
        // Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð¾ÑÑ‚Ð°Ð²Ð¸Ð¼ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð° Ð²Ð¸Ð´Ð¸Ð¼Ñ‹Ð¼
        const block = document.getElementById('main-logo-block');
        if (block) block.style.display = '';
        const img = document.getElementById('main-logo');
        if (img) img.style.display = '';
      }

      function apply(collapsed) {
        const isCollapsed = !!collapsed;
        menu.classList.toggle('collapsed', isCollapsed);
        btn.setAttribute('aria-expanded', String(!isCollapsed));

        // Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð½Ð°Ð´Ð¿Ð¸ÑÑŒ dmTranscribe â†” JMTG
        const full  = brand.getAttribute('data-full')  || brand.textContent;
        const short = brand.getAttribute('data-short') || 'JMTG';
        brand.textContent = isCollapsed ? short : full;

        // ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ðµ: ÑÐ¾Ð¾Ð±Ñ‰Ð°ÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑŽ, Ñ‡Ñ‚Ð¾ Ð¼ÐµÐ½ÑŽ ÑÐ²ÐµÑ€Ð½ÑƒÑ‚Ð¾/Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¾
        const root = document.querySelector('.app-root');
        if (root) root.classList.toggle('leftmenu-collapsed', isCollapsed);
      }


      // Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð¼ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ
      const saved = localStorage.getItem(LS_KEY) === '1';
      apply(saved);

      // ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐ²ÐµÑ€Ð½ÑƒÑ‚ÑŒ/Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ
      btn.addEventListener('click', () => {
        const willCollapse = !menu.classList.contains('collapsed');
        apply(willCollapse);
        localStorage.setItem(LS_KEY, willCollapse ? '1' : '0');
      });

      // ÐšÐ»Ð¸Ðº Ð¿Ð¾ Ð±Ñ€ÐµÐ½Ð´Ñƒ â€” Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Â«Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¾ÐºÐ½Ð¾Â» (Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿)
      brand.style.userSelect = 'none';
      brand.addEventListener('click', showHomeLogo);
    })();


  </script>
</body>
</html>
